<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="set-exception-response-subflow" doc:id="9620166e-0231-4901-950c-1e77bc119930" >
		<json-logger:logger doc:id="1b79d9fd-62a5-4cbf-a9d0-5de0fef503d0" config-ref="JSON_Logger_Config" message="#[error.detailedDescription]" doc:name="Log Exception" tracePoint="EXCEPTION" priority="DEBUG" category='#["esb.api-user-v1.set-exception-response-subflow.log-exception.error"]'/>
		<ee:transform doc:name="Map Exception Response Payload" doc:id="85f74a4b-86df-4db0-98d1-f090e511c9f3" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  'error': {
		'status': vars.errorStatus,
		'code': vars.errorCode,
		'title': vars.errorTitle,
		'details': vars.errorDetails
	}
}]]></ee:set-payload>
				<ee:set-attributes ><![CDATA[%dw 2.0
output application/java
---
{
	statusCode: vars.errorStatus
}]]></ee:set-attributes>
			</ee:message>
		</ee:transform>
		<set-variable value="#[vars.errorStatus]" doc:name="Set httpStatus" doc:id="d1cfc2b8-9a1c-4c95-9d92-cb4bcfd82e12" variableName="httpStatus" />
	</sub-flow>
	<error-handler name="apikit-error-handler" doc:id="12fbe9f7-78f8-46fb-a5bb-64c674604a84" >
<!-- [STUDIO:"On Error Propagate"]		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="bf409483-b459-492e-8d53-4b572e0b6015" type="APIKIT:BAD_REQUEST" when="attributes.headers.'code' == null">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="87bd59bf-b332-449d-a301-2864c4db9042">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
&#45;&#45;-
p('log.category.base') ++ '.unauthorized.error'&#93;&#93;></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
&#45;&#45;-
p('error.apikit.unauthorized.statusCode')&#93;&#93;></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
&#45;&#45;-
p('error.apikit.unauthorized.title')&#93;&#93;></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
&#45;&#45;-
p('error.apikit.unauthorized.errorCode')&#93;&#93;></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
&#45;&#45;-
p('error.apikit.unauthorized.description') ++ ':' ++ (error.description default '')&#93;&#93;></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="207dfd82-82d2-4d7d-afd4-281dda2b3b23" name="set-exception-response-subflow" />
		</on-error-propagate> [STUDIO] -->
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="c5e7cb31-100d-4abc-80d9-99e1819479cd" type="HTTP:TIMEOUT">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="0391c5a2-4b6d-44ca-a3f9-8e066e02f2c7">
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.timeout.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.timeout.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.timeout.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.timeout.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.timeout.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="ef673971-fa26-4d4d-bb4e-f1cc63570cb0" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="22736c51-1d98-4803-aff7-768f2d4ef3ad" type="APIKIT:NOT_IMPLEMENTED">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="02610749-3583-4e8a-8666-acf6c8acefe8">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notimplemented.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notimplemented.description')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notimplemented.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notimplemented.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.not-implemented.error']]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="0a4f974f-cce7-4ac6-b968-0264f2c3225c" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="2ac743c1-812d-4c0d-8b25-c38e0f0d4020" type="APIKIT:UNSUPPORTED_MEDIA_TYPE">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="65c9bc89-0f68-4920-9bd0-9b4f79aee4a2">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.media-type-unsupported.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.mediatypeunsupported.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.mediatypeunsupported.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.mediatypeunsupported.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.mediatypeunsupported.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="77d98317-8412-4877-be82-1ddcf7c3177f" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="20ca31b7-0295-40ef-bbb1-1fb011810a25" type="APIKIT:NOT_ACCEPTABLE">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="66689c8a-22dc-432c-8ec6-9c11aa524d5f">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.not-acceptable.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notacceptable.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notacceptable.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notacceptable.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notacceptable.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="c6f85dc9-91d8-421d-bbc1-e25602ecf1aa" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="cfb8dd75-8cdd-4d55-8880-ffa4aff5d9ff" type="APIKIT:METHOD_NOT_ALLOWED">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="464201d5-1c97-4220-92d1-feeaa4200bb5">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.method-not-allowed.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.methodnotallowed.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.methodnotallowed.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.methodnotallowed.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.methodnotallowed.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="48f9889e-6d07-4a51-b56d-467183b2724c" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="2faf8f77-a0ad-4e51-b61a-ac3205b39bf3" type="APIKIT:NOT_FOUND">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="a785d03a-85a8-4edc-9825-d9e81d96939f">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.not-found.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notfound.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notfound.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notfound.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.notfound.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="7bbb0a88-d576-41e4-8a0f-04b2b9d87412" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="42c4d0ab-4fc4-42d8-af23-2e73d38b1046" type="APIKIT:BAD_REQUEST">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="8c7865eb-8705-4a02-bda0-ee8620501da1">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
if (error.description contains "requestCode")
	p('log.category.base') ++ '.unauthorized.error'
else
	p('log.category.base') ++ '.bad-request.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
if (error.description contains "requestCode")
	p('error.apikit.unauthorized.statusCode')
else
	p('error.apikit.badrequest.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
if (error.description contains "requestCode")
	p('error.apikit.unauthorized.title')
else
	p('error.apikit.badrequest.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
if (error.description contains "requestCode")
	p('error.apikit.unauthorized.errorCode')
else
	p('error.apikit.badrequest.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
if (error.description contains "requestCode")
	p('error.apikit.unauthorized.description')
else
	p('error.apikit.badrequest.description') ++ ': ' ++ (error.description default '')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="5a3ec7ab-8749-400d-991f-558ff412b620" name="set-exception-response-subflow" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="45503315-325f-4c79-9881-e4f76b0c9af7" type="ANY">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="dc88a86c-f1a7-4f4f-9e91-939a7b0e1fad">
				<ee:message />
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.unexpected-server-exception.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.default.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.default.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.default.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.apikit.default.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="a51d442b-475e-499e-861d-b851b4690306" name="set-exception-response-subflow" />
		</on-error-propagate>
	</error-handler>
	<error-handler name="app-error-handler" doc:id="0f578d08-b7ab-484c-b7cd-06de7cc6fb5a" >
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="967c9195-8eb2-4065-9454-5894400ecd2b" type="USER:NOT_FOUND">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="14d1949c-5e87-437a-a50b-4318ebed801d">
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.user.not-found.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.usernotfound.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.usernotfound.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.usernotfound.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.usernotfound.description') ++ ': ' ++ (error.description default '')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="115a303f-eae5-493b-a910-9e4af0d5bdbe" name="set-exception-response-subflow" />
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="20707dfd-9ab9-4f56-ac34-a310ddd7bf91" type="USER:INACTIVE">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="7f9930b4-91a3-44e8-87da-a0ca14362fa3">
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.user.inactive.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.inactiveuser.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.inactiveuser.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.inactiveuser.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.inactiveuser.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="642cc24f-482c-419c-8c5c-1c986d8421f7" name="set-exception-response-subflow" />
		</on-error-continue>
		<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="e996bb46-ca17-4dad-b652-71dde774901e" type="ANY">
			<ee:transform doc:name="Set Variable - logCategory, errorStatus, errorTitle, errorCode, errorDetails" doc:id="c177ae03-26f5-440c-96f7-28e7aab2cf19">
				<ee:variables>
					<ee:set-variable variableName="logCategory"><![CDATA[%dw 2.0
output application/java
---
p('log.category.base') ++ '.unexpected-server-exception.error']]></ee:set-variable>
					<ee:set-variable variableName="errorStatus"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.default.statusCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorTitle"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.default.title')]]></ee:set-variable>
					<ee:set-variable variableName="errorCode"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.default.errorCode')]]></ee:set-variable>
					<ee:set-variable variableName="errorDetails"><![CDATA[%dw 2.0
output application/java
---
p('error.user.api.default.description')]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<flow-ref doc:name="Invoke Set Exception Response" doc:id="e0b26b4a-121a-4839-8fb5-ebe3390d0abb" name="set-exception-response-subflow" />
		</on-error-continue>
	</error-handler>
</mule>
