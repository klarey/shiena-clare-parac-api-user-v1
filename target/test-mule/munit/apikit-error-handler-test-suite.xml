<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<munit:config name="apikit-error-handler-test-suite.xml" />
	<munit:test name="apikit-error-handler-test-suite-not-acceptable-test" doc:id="a40e89d8-456f-4b59-998c-f03039208d70" description="Test" expectedErrorType="HTTP:NOT_ACCEPTABLE">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when APIKIT:NOT_ACCEPTABLE" doc:id="94633f16-6e38-4b09-98d7-5a931ad1de4f" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_ACCEPTABLE" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="e58cf343-09b2-4942-8a34-0f33fed3ebca" config-ref="HTTP_Request_configuration" path="users"/>
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-http-timeout-test" doc:id="736fb803-b2df-43aa-8bab-ef487206b59a" expectedErrorType="HTTP:GATEWAY_TIMEOUT">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when HTTP:TIMEOUT" doc:id="a4ae250f-6642-43ca-8ebd-9399ab2c0fb8" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="HTTP:TIMEOUT" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="8454768f-7987-46e7-9820-807a8bd7c97c" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-not-implemented-test" doc:id="f473876f-0942-423b-9965-47eccdc407a5" description="Test" expectedErrorType="MULE:UNKNOWN">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when APIKIT:NOT_IMPLEMENTED" doc:id="f35eb086-7de6-44fb-a73a-1dcacf1a1651" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_IMPLEMENTED" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="d6e18889-cb01-49e7-8aac-bc9b18de1e61" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-method-not-allowed-test" doc:id="592929b1-df36-41b6-ab23-54e572de0169" expectedErrorType="HTTP:METHOD_NOT_ALLOWED">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when APIKIT:METHOD_NOT_ALLOWED" doc:id="9fce2440-550e-43f3-b568-804e2f46c6c9" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:METHOD_NOT_ALLOWED" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="4c531152-4e50-4ec2-9068-5bcc073e3920" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-not-found-test" doc:id="6410be1f-d76c-4aeb-be75-c39ffe005202" description="Test" expectedErrorType="HTTP:NOT_FOUND">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when APIKIT:NOT_FOUND" doc:id="9a50085b-e421-459b-8f15-f388136d5be3" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:NOT_FOUND" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="bbc9aff4-d5b8-4f01-8aca-71f647bb8b23" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-unsupported-media-type-test" doc:id="3a48cc4e-63ef-4a5d-b18d-c6f9f7e2a009" expectedErrorType="HTTP:UNSUPPORTED_MEDIA_TYPE">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when APIKIT:UNSUPPORTED_MEDIA_TYPE" doc:id="5a2baba6-8343-47d8-af17-54224500a7ae" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="APIKIT:UNSUPPORTED_MEDIA_TYPE" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="4191ce80-5adb-49b8-959e-b0f5cf6b772d" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-default-error-test" doc:id="23a5e87e-d7f6-46c2-89a9-4a0caa6f6f57" expectedErrorType="HTTP:INTERNAL_SERVER_ERROR">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:behavior >
			<munit-tools:mock-when doc:name="Mock when HTTP:BAD_GATEWAY" doc:id="61e8ad93-afc8-4050-aaf6-480d16297ed5" processor="apikit:router" >
				<munit-tools:with-attributes >
					<munit-tools:with-attribute whereValue="api-user-v1-config" attributeName="config-ref" />
				</munit-tools:with-attributes>
				<munit-tools:then-return >
					<munit-tools:error typeId="HTTP:BAD_GATEWAY" />
				</munit-tools:then-return>
			</munit-tools:mock-when>
		</munit:behavior>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="54264041-89f9-4944-b452-62102a467e27" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-unauthorized-test" doc:id="a0a2b958-2b60-40ca-91e4-c123349d91e5" expectedErrorType="HTTP:UNAUTHORIZED">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users" doc:id="35b74dad-7f48-4aea-8335-de74b1dfcab9" config-ref="HTTP_Request_configuration" path="users" />
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-post-users-bad-request-empty-username-field-test" doc:id="cb354a5c-842e-4ca8-a2e4-db8350be914a" description="Test" expectedErrorType="HTTP:BAD_REQUEST">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="post:\users:application\json:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="POST" doc:name="POST /users" doc:id="7e94e9f7-a8be-4877-8458-7f440e3d9ba8" config-ref="HTTP_Request_configuration" path="users" >
				<http:body ><![CDATA[#[output application/json
---
{
	"users": [
		{
            "username": "",
            "fullname": "Derk Fern",
            "birthday": "02-05-1994",
            "gender": "male",
            "dateRegistered": "20-08-2021"
        }
	]
}]]]></http:body>
				<http:headers ><![CDATA[#[output application/java
---
{
	"requestCode" : "aOEF3M2cEG0204NO"
}]]]></http:headers>
			</http:request>
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-post-users-bad-request-incomplete-details-test" doc:id="5df0560c-6fcb-47ed-a8c9-937f5ad153af" description="Test" expectedErrorType="HTTP:BAD_REQUEST">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="post:\users:application\json:api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="POST" doc:name="POST /users" doc:id="7e01534c-81bf-4754-9537-1bcff93d8c0f" config-ref="HTTP_Request_configuration" path="users" >
				<http:body ><![CDATA[#[output application/json
---
{
	"users": [
		{
            "usernameTest": "derk",
            "fullname": "Derk Fern",
            "birthday": "02-05-1994",
            "gender": "male",
            "dateRegistered": "20-08-2021"
        }
	]
}]]]></http:body>
				<http:headers ><![CDATA[#[output application/java
---
{
	"requestCode" : "aOEF3M2cEG0204NO"
}]]]></http:headers>
			</http:request>
		</munit:execution>
	</munit:test>
	<munit:test name="apikit-error-handler-test-suite-get-user-by-username-bad-request-null-username-test" doc:id="f24c3998-ec26-4d79-99f1-4e31223961c9" description="Test" expectedErrorType="HTTP:BAD_REQUEST">
		<munit:enable-flow-sources >
			<munit:enable-flow-source value="api-user-v1-main" />
			<munit:enable-flow-source value="get:\users\(username):api-user-v1-config" />
		</munit:enable-flow-sources>
		<munit:execution >
			<http:request method="GET" doc:name="GET /users by username" doc:id="40acae72-0c9e-4084-9382-c116d0433e9a" config-ref="HTTP_Request_configuration" path="users/" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"requestCode" : "aOEF3M2cEG0204NO"
}]]]></http:headers>
			</http:request>
		</munit:execution>
	</munit:test>

</mule>
